---
title: "Appendix"
output: html_document
date: "2024-09-17"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
source("required.R")
```

# Purpose

The purpose of this page is to document some of the functions used to generate and process data.

# SNV scores

SNV scores are generated for each cell by dividing the number of SNVs detected by the number of fragments that overlap the SNV site. cb_sniffer is a tool that parses BAM files to search for known SNVs (used as input). 

```{r}
# system call to generate cb_sniffer data
```

Total number of fragments overlapping a site is in `total_CB`, whereas number of fragments containing the SNV is in `alt_count`.

```{r}
example <- fread("/projects/marralab/cayan_prj/PrecisionMed/Objects/POG003_2/cbSnifferOuts/allCells_cbRNA_counts_CB.tsv")
head(example)
```

```{r eval = FALSE}
for(f in files[-10]){
  # snv calls from rna
  snvRNA <- fread(paste0(path, f, "/cbSnifferOuts/allCells_cbRNA_counts_CB.tsv"))
  
  # snv calls from atac
  snvATAC <- fread(paste0(path, f, "/cbSnifferOuts/allCells_cbATAC_counts_CB.tsv")) %>%
    mutate(barcode = convert_atac_indices(barcode)) # converting to rna barcodes
  
  allSNVs <- rbind(snvRNA, snvATAC) %>%
    group_by(barcode) %>%
    summarize(totalFragments = sum(total_CB),
              numSNVs = sum(alt_count)) %>%
    mutate(snvScore = numSNVs / totalFragments)
  write_tsv(allSNVs, paste0(path, f, "/snvScores_rnaFiltering.tsv"))
}
```

# Identifying malignant cells

Malignant cells are identified on a per cluster basis. 

```{r}

```

# CNV calling







